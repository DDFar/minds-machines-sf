<!-- import polymer -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- import page level css -->
<link rel="import" href="ge-app-styles.html">

<!-- app route -->
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/px-app-helpers/px-app-route/px-app-route.html"/>

<!-- px components -->
<link rel="import" href="../../bower_components/px-app-nav/px-app-nav.html">
<link rel="import" href="../../bower_components/px-view/px-view.html">

<!-- px components used by multiple views -->
<link rel="import" href="../../bower_components/px-card/px-card.html">

<link rel="import" href="../ge-svg-logo/ge-svg-logo.html">
<link rel="import" href="../predix-logo/predix-logo.html">
<link rel="import" href="../ge-app-footer/ge-app-footer.html">

<link rel="import" href="../../bower_components/px-view-header/px-view-header.html">

<dom-module id="ge-app">
    <template>

        <!-- apply imported seed app style module -->
        <style include="ge-app-css"></style>

        <header role="banner" class="flex flex--middle">
            <div class="viewport flex">
                <h3 class="flex__item app-title">
                    <ge-svg-logo class="u-mr--"></ge-svg-logo>
                    your__app__title
                </h3>
                <div class="flex__item">
                    <div class="flex" style="text-align:right;">
                        <h3 class="flex__item weight--normal logo">Powered by
                            <predix-logo style="display:inline-block; width: 82px;" class="flex__item"></predix-logo>
                        </h3>
                    </div>
                </div>
            </div>
        </header>

        <div class="viewport">
            <px-app-nav
                items="{{navItems}}"
                selected-route={{selectedNavRoute}}>
            </px-app-nav>
            <div class="content-wrapper">
                <main role="main">
                    <!-- app-location captures url and assigns navRoute value -->
                    <app-location
                        id="carbonLocation"
                        route="{{route}}">
                    </app-location>

                    <!-- /view1 route and view -->
                    <px-app-route
                        route="{{route}}"
                        update-nav-route
                        nav-route="{{selectedNavRoute}}">
                    </px-app-route>

                    <px-view
                        active="[[view1Active]]"
                        element-href="./elements/views/view-1.html">
                    </px-view>

                    <px-view
                        active="[[view2Active]]"
                        element-href="./elements/views/view-2.html">
                    </px-view>
                </main>
            </div>
        </div>

        <ge-app-footer footer-links="[[footerLinks]]"></ge-app-footer>
    </template>

    <script>

        "use strict";

        Polymer({
            is: "ge-app",

            properties: {

                // Global application object
                global: {
                    type: Object,
                    value: function () {
                        return {
                            name: "ge__app",
                            session: {},
                            version: "1.0"
                        };
                    }
                },

                view1Active: {
                    type: Boolean
                },

                view2Active: {
                    type: Boolean
                },

                selectedNavRoute: {
                    type: String,
                    observer: "observerSelectRoute"
                },

                navItems: {
                    type: Array,
                    value: function () {
                        return [
                            {
                                icon: "fa-tachometer",
                                label: "View 1",
                                id: "view-1"
                            }, {
                                icon: "fa-file",
                                label: "View 2",
                                id: "view-2"
                            }, {
                                icon: "fa-sign-out",
                                label: "Sign out",
                                id: "logout"
                            }
                        ];
                    }
                },

                footerLinks: {
                    type: Array,
                    value: function () {
                        return [
                            {
                                label: "Privacy",
                                href: "#",
                                target: "_blank"
                            }, {
                                label: "Terms",
                                href: "#",
                                target: "_blank"
                            }, {
                                label: "Contact",
                                href: "#",
                                target: "_blank"
                            }, {
                                label: "Accessibility",
                                href: "#",
                                target: "_blank"
                            }, {
                                label: "Cookies",
                                href: "#",
                                target: "_blank"
                            }
                        ];
                    }
                },

                // Sets app default base URL for client-side routing
                routesActive: {
                    type: Boolean,
                    value: false
                }
            },

            ready: function () {
                this._checkForDefaultRoute();
            },

            observerSelectRoute: function () {
              if (this.selectedNavRoute) {
                if (this.selectedNavRoute.includes("view-1")) {
                   this.view1Active = true;
                   this.view2Active = false;
                } else {
                   this.view1Active = false;
                   this.view2Active = true;
                }
              }
            },

            _checkForDefaultRoute: function () {
                // Set default route to /view-1
                if (window.location.pathname === "/") {
                    window.history.replaceState({}, null, "/view-1");
                    // Emit location-changed event to trigger the update of app-location
                    window.dispatchEvent(new CustomEvent("location-changed"));
                    // Emit popstate event to trigger highlighting in the side menu
                    window.dispatchEvent(new CustomEvent("popstate"));
                }
            }
        });
    </script>
</dom-module>
